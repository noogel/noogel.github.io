<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 7.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/resource/img/favicon2018.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/resource/img/favicon2018.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/resource/img/favicon2018.png">
  <link rel="mask-icon" href="/resource/img/favicon2018.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"noogel.xyz","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="知一杂谈">
<meta property="og:url" content="https://noogel.xyz/page/7/index.html">
<meta property="og:site_name" content="知一杂谈">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="noogel">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://noogel.xyz/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>知一杂谈</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?9cdc9a11cbd242c6336b07c464d8820c"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="知一杂谈" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">知一杂谈</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">我思故我在</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-career"><a href="/career/" rel="section"><i class="sitemap fa-fw"></i>├ 技术</a></li>
        <li class="menu-item menu-item-life"><a href="/life/" rel="section"><i class="sitemap fa-fw"></i>├ 生活</a></li>
        <li class="menu-item menu-item-future"><a href="/future/" rel="section"><i class="sitemap fa-fw"></i>└ 未来</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">noogel</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">79</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/noogel" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;noogel" rel="noopener" target="_blank"><i class="github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:noogel@163.com" title="E-Mail → mailto:noogel@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/12/17/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/17/1.html" class="post-title-link" itemprop="url">MySQL一些零散记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-17 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-17T00:00:00+00:00">2017-12-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="MySQL-大小写区分问题"><a href="#MySQL-大小写区分问题" class="headerlink" title="MySQL 大小写区分问题"></a>MySQL 大小写区分问题</h2><p><img src="/resource/img/15135036470309.jpg"></p>
<h2 id="sql-mode-配置"><a href="#sql-mode-配置" class="headerlink" title="sql_mode 配置"></a>sql_mode 配置</h2><p>Modes affect the SQL syntax MySQL supports and the data validation checks it performs. This makes it easier to use MySQL in different environments and to use MySQL together with other database servers.</p>
<h3 id="查看当前sql-mode"><a href="#查看当前sql-mode" class="headerlink" title="查看当前sql_mode"></a>查看当前sql_mode</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@GLOBAL.sql_mode;</span><br><span class="line">SELECT @@SESSION.sql_mode;</span><br></pre></td></tr></table></figure>

<h3 id="设置当前sql-mode"><a href="#设置当前sql-mode" class="headerlink" title="设置当前sql_mode"></a>设置当前sql_mode</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL sql_mode = &#x27;modes...&#x27;;</span><br><span class="line">SET SESSION sql_mode = &#x27;modes...&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="Full-list-of-SQL-Models"><a href="#Full-list-of-SQL-Models" class="headerlink" title="Full list of SQL Models"></a>Full list of SQL Models</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html">https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html</a></p>
<h2 id="x2F-40001-SQL-NO-CACHE-x2F"><a href="#x2F-40001-SQL-NO-CACHE-x2F" class="headerlink" title="&#x2F;*!40001 SQL_NO_CACHE *&#x2F;"></a>&#x2F;*!40001 SQL_NO_CACHE *&#x2F;</h2><p><code>/*!  */</code> 这是 mysql 里的语法，并非注释，<code>!</code> 后面是版本号，如果本数据库等于或大于此版本号，那么注释内的代码也会执行。</p>
<p>关于这个条件的问答： <a target="_blank" rel="noopener" href="https://lists.mysql.com/mysql/203373">https://lists.mysql.com/mysql/203373</a></p>
<h2 id="MySQL-锁表种类"><a href="#MySQL-锁表种类" class="headerlink" title="MySQL 锁表种类"></a>MySQL 锁表种类</h2><p>常见的有行锁和表锁。表锁会锁住整张表，并发能力弱，开发中要避免使用表级锁。行锁只将单行数据锁住，锁数据期间对其它行数据不影响，并发能力高，一般使用行锁来处理并发事务。<br>MySQL是如何加不同类型的锁的？对于加锁数据的筛选条件，有其对应的索引建立，MySQL可以快速定位的数据进行行级加锁；而对于没有索引的情况，MySQL 的做法是会先锁住整张表，然后再去获取数据，然后将不满足条件的数据锁释放掉。</p>
<h2 id="等待锁超时问题"><a href="#等待锁超时问题" class="headerlink" title="等待锁超时问题"></a>等待锁超时问题</h2><p><em>Lock wait timeout exceeded; try restarting transaction</em><br>一种情况是因为有操作语句对整个表加锁了，这里发现的例子是在开启事务做 UPDATE 更新时发现的，UPDATE 条件如果不是主键或者没有索引则会锁整张表，只有以主键为条件或完全匹配的唯一索引做更新才是行级锁。<br>还有就是另一个事务中持有锁时间过长导致。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM INNODB_TRX;  // 查看事务表锁状态</span><br><span class="line"></span><br><span class="line">// 创建事务，更新语句，但是不提交</span><br><span class="line">SET SESSION AUTOCOMMIT=off;</span><br><span class="line">BEGIN;</span><br><span class="line">UPDATE tabl1 SET status=1 WHERE expired_at &lt;123456 AND expired_at &gt;= 12346 AND `status` = 0;</span><br></pre></td></tr></table></figure>
<p>这时候再去提交则会报等待锁超时问题。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.toniz.net/?p=556">http://www.toniz.net/?p=556</a></p>
</blockquote>
<p>加行锁的注意事项：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/u014453898/article/details/56068841">http://blog.csdn.net/u014453898/article/details/56068841</a></p>
</blockquote>
<h2 id="插入语句死锁问题"><a href="#插入语句死锁问题" class="headerlink" title="插入语句死锁问题"></a>插入语句死锁问题</h2><p>在 INSERT 语句中出现 <em>Deadlock found when trying to get lock; try restarting transaction</em> 是因为范围匹配加锁是对索引页加锁了，导致其它事务插入数据时报死锁。处理办法是查询改成行锁，以 ID 或唯一索引加锁。</p>
<blockquote>
<p>这里需要强调的是尽量避免使用范围加锁。最好是通过主键加行锁处理。</p>
</blockquote>
<h2 id="避免加锁失败和发生死锁的注意事项"><a href="#避免加锁失败和发生死锁的注意事项" class="headerlink" title="避免加锁失败和发生死锁的注意事项"></a>避免加锁失败和发生死锁的注意事项</h2><ol>
<li>减少锁占用时间，避免拿锁时做过多耗时操作。</li>
<li>加锁条件需对应加索引，尽量为行级锁。</li>
<li>避免死锁需要再开启事务后一次将所需资源加锁，处理后及时 COMMIT 释放锁。</li>
<li>对于请求的网络资源，首先将所需外部资源准备好。</li>
</ol>
<ul>
<li>对于开启事物后加锁，只有 COMMIT 后方可释放锁</li>
<li>在捕获异常中的处理，在捕获异常后要记得 ROLLBACK</li>
<li>等待锁超时时间一般设置在 1-2 秒时间 <code>SET innodb_lock_wait_timeout=1</code>。</li>
</ul>
<h2 id="MySQL-事务"><a href="#MySQL-事务" class="headerlink" title="MySQL 事务"></a>MySQL 事务</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zhaoyangjian724/article/details/52858519">http://blog.csdn.net/zhaoyangjian724/article/details/52858519</a></p>
</blockquote>
<p>先非主键范围加锁<br>查看事务状态<br>插入区分度高的数据-成功<br>插入区分度低的数据-失败<br>查看引擎状态，发现页锁<br>改为以主键做查询条件加锁<br>插入区分度低的数据-成功</p>
<p>SELECT * FROM INNODB_TRX;</p>
<p>SHOW ENGINE INNODB STATUS;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">=====================================</span><br><span class="line">2017-12-18 11:47:27 7fd5dd6f6700 INNODB MONITOR OUTPUT</span><br><span class="line">=====================================</span><br><span class="line">Per second averages calculated from the last 57 seconds</span><br><span class="line">-----------------</span><br><span class="line">BACKGROUND THREAD</span><br><span class="line">-----------------</span><br><span class="line">srv_master_thread loops: 22630 srv_active, 0 srv_shutdown, 15047550 srv_idle</span><br><span class="line">srv_master_thread log flush and writes: 15067795</span><br><span class="line">----------</span><br><span class="line">SEMAPHORES</span><br><span class="line">----------</span><br><span class="line">OS WAIT ARRAY INFO: reservation count 21761</span><br><span class="line">OS WAIT ARRAY INFO: signal count 42765</span><br><span class="line">Mutex spin waits 38129, rounds 296291, OS waits 3638</span><br><span class="line">RW-shared spins 25778, rounds 578697, OS waits 16634</span><br><span class="line">RW-excl spins 4632, rounds 145148, OS waits 1184</span><br><span class="line">Spin rounds per wait: 7.77 mutex, 22.45 RW-shared, 31.34 RW-excl</span><br><span class="line">------------</span><br><span class="line">TRANSACTIONS</span><br><span class="line">------------</span><br><span class="line">Trx id counter 167458</span><br><span class="line">Purge done for trx&#x27;s n:o &lt; 167444 undo n:o &lt; 0 state: running but idle</span><br><span class="line">History list length 942</span><br><span class="line">LIST OF TRANSACTIONS FOR EACH SESSION:</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2700260, OS thread handle 0x7fd5dd6f6700, query id 16186792 10.21.0.2 wallet init</span><br><span class="line">SHOW ENGINE INNODB STATUS</span><br><span class="line">---TRANSACTION 167433, not started</span><br><span class="line">MySQL thread id 2700100, OS thread handle 0x7fd5dd7fa700, query id 16185344 10.100.27.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 167449, not started</span><br><span class="line">MySQL thread id 2700073, OS thread handle 0x7fd5e6581700, query id 16186116 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 167434, not started</span><br><span class="line">MySQL thread id 2700060, OS thread handle 0x7fd5e6685700, query id 16185479 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699993, OS thread handle 0x7fd5dd5f2700, query id 16184159 10.100.27.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699968, OS thread handle 0x7fd5dd633700, query id 16183926 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699967, OS thread handle 0x7fd5dd7b9700, query id 16183863 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699966, OS thread handle 0x7fd5e6540700, query id 16183754 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699965, OS thread handle 0x7fd5e4049700, query id 16183668 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699964, OS thread handle 0x7fd5e66c6700, query id 16183581 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699963, OS thread handle 0x7fd5dd6b5700, query id 16183494 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 167457, ACTIVE 11 sec inserting</span><br><span class="line">mysql tables in use 1, locked 1</span><br><span class="line">LOCK WAIT 2 lock struct(s), heap size 360, 1 row lock(s), undo log entries 1</span><br><span class="line">MySQL thread id 2700275, OS thread handle 0x7fd5dd737700, query id 16186778 10.21.0.2 wallet update</span><br><span class="line">INSERT INTO `ttt` (`id`, `no`, `trade_number`)</span><br><span class="line">VALUES</span><br><span class="line">	(586, &#x27;856195904590458889&#x27;, &#x27;200526175912156728&#x27;)</span><br><span class="line">------- TRX HAS BEEN WAITING 11 SEC FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 50 page no 5 n bits 96 index `idx_number` of table `test`.`ttt` trx id 167457 lock_mode X locks gap before rec insert intention waiting</span><br><span class="line">Record lock, heap no 14 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 29; hex 5a484c4956454255593230313730353236323233323432363434353939; asc ZHLIVEBUY20170526223242644599;;</span><br><span class="line"> 1: len 8; hex 0000000000000229; asc        );;</span><br><span class="line"></span><br><span class="line">------------------</span><br><span class="line">---TRANSACTION 167447, ACTIVE 602 sec</span><br><span class="line">4 lock struct(s), heap size 1184, 3 row lock(s)</span><br><span class="line">MySQL thread id 2699383, OS thread handle 0x7fd5e4251700, query id 16186751 10.21.0.2 wallet cleaning up</span><br><span class="line">--------</span><br><span class="line">FILE I/O</span><br><span class="line">--------</span><br><span class="line">I/O thread 0 state: waiting for completed aio requests (insert buffer thread)</span><br><span class="line">I/O thread 1 state: waiting for completed aio requests (log thread)</span><br><span class="line">I/O thread 2 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 3 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 4 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 5 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 6 state: waiting for completed aio requests (write thread)</span><br><span class="line">I/O thread 7 state: waiting for completed aio requests (write thread)</span><br><span class="line">I/O thread 8 state: waiting for completed aio requests (write thread)</span><br><span class="line">I/O thread 9 state: waiting for completed aio requests (write thread)</span><br><span class="line">Pending normal aio reads: 0 [0, 0, 0, 0] , aio writes: 0 [0, 0, 0, 0] ,</span><br><span class="line"> ibuf aio reads: 0, log i/o&#x27;s: 0, sync i/o&#x27;s: 0</span><br><span class="line">Pending flushes (fsync) log: 0; buffer pool: 0</span><br><span class="line">6707 OS file reads, 383968 OS file writes, 119945 OS fsyncs</span><br><span class="line">0.00 reads/s, 0 avg bytes/read, 0.11 writes/s, 0.09 fsyncs/s</span><br><span class="line">-------------------------------------</span><br><span class="line">INSERT BUFFER AND ADAPTIVE HASH INDEX</span><br><span class="line">-------------------------------------</span><br><span class="line">Ibuf: size 1, free list len 74, seg size 76, 733 merges</span><br><span class="line">merged operations:</span><br><span class="line"> insert 34, delete mark 169019, delete 2</span><br><span class="line">discarded operations:</span><br><span class="line"> insert 0, delete mark 0, delete 0</span><br><span class="line">Hash table size 149489, node heap has 168 buffer(s)</span><br><span class="line">0.00 hash searches/s, 0.05 non-hash searches/s</span><br><span class="line">---</span><br><span class="line">LOG</span><br><span class="line">---</span><br><span class="line">Log sequence number 394355624</span><br><span class="line">Log flushed up to   394355624</span><br><span class="line">Pages flushed up to 394355624</span><br><span class="line">Last checkpoint at  394355624</span><br><span class="line">0 pending log writes, 0 pending chkp writes</span><br><span class="line">65750 log i/o&#x27;s done, 0.04 log i/o&#x27;s/second</span><br><span class="line">----------------------</span><br><span class="line">BUFFER POOL AND MEMORY</span><br><span class="line">----------------------</span><br><span class="line">Total memory allocated 77266944; in additional pool allocated 0</span><br><span class="line">Dictionary memory allocated 669112</span><br><span class="line">Buffer pool size   4607</span><br><span class="line">Free buffers       1024</span><br><span class="line">Database pages     3415</span><br><span class="line">Old database pages 1240</span><br><span class="line">Modified db pages  0</span><br><span class="line">Pending reads 0</span><br><span class="line">Pending writes: LRU 0, flush list 0, single page 0</span><br><span class="line">Pages made young 11699, not young 475003</span><br><span class="line">0.00 youngs/s, 0.00 non-youngs/s</span><br><span class="line">Pages read 6606, created 13587, written 300725</span><br><span class="line">0.00 reads/s, 0.00 creates/s, 0.05 writes/s</span><br><span class="line">Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000</span><br><span class="line">Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s</span><br><span class="line">LRU len: 3415, unzip_LRU len: 0</span><br><span class="line">I/O sum[3]:cur[0], unzip sum[0]:cur[0]</span><br><span class="line">--------------</span><br><span class="line">ROW OPERATIONS</span><br><span class="line">--------------</span><br><span class="line">0 queries inside InnoDB, 0 queries in queue</span><br><span class="line">0 read views open inside InnoDB</span><br><span class="line">Main thread process no. 12657, id 140556665968384, state: sleeping</span><br><span class="line">Number of rows inserted 227014, updated 19739, deleted 89828, read 47831814</span><br><span class="line">0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s</span><br><span class="line">----------------------------</span><br><span class="line">END OF INNODB MONITOR OUTPUT</span><br><span class="line">============================</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/10/08/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/08/1.html" class="post-title-link" itemprop="url">这些 Mac 神器也许你正需要</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-08 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-08T00:00:00+00:00">2017-10-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这篇文章主要介绍Mac下常用的效率工具，也许正是你所需要的或者使用后对你的工作有很大的效率提升，废话不多说，看下面介绍的五款常用效率工具。</p>
<h2 id="Alfred"><a href="#Alfred" class="headerlink" title="Alfred"></a>Alfred</h2><p> <br><img src="/resource/img/efficiency/a1.png" alt="Alfred"></p>
<p>Alfred 作为神器的霸主地位可谓实至名归，它不仅可以帮我们快速打开切换应用、打开网址，使用计算器、词典、剪贴板增强等功能，还可以通过Workflow模块实现功能的扩展，下面详细介绍一下此神器的一些功能。</p>
<p>首先我们定义调出 Alfred 的快捷键，这里我设置的是 Command + Space ，可以启动输入框。</p>
<p><img src="/resource/img/efficiency/a2.png" alt="Alfred"></p>
<p>在输入框中我们可以输入想要打开或切换的应用：</p>
<p><img src="/resource/img/efficiency/a3.png" alt="Alfred"></p>
<p>也可以输入基本的数学公式，计算结果：</p>
<p><img src="/resource/img/efficiency/a4.png" alt="Alfred"></p>
<p>或者去 Google 搜索：</p>
<p><img src="/resource/img/efficiency/a5.png" alt="Alfred"></p>
<p>打开 Terminal 执行命令：</p>
<p><img src="/resource/img/efficiency/a6.png" alt="Alfred"></p>
<p>在 Web Search 中配置自定义打开的网址：</p>
<p><img src="/resource/img/efficiency/a7.png" alt="Alfred"></p>
<p>调出剪贴板历史，我设置的快捷键是 Option + Command + C：</p>
<p><img src="/resource/img/efficiency/a8.png" alt="Alfred"></p>
<p>默认回车会执行第一个结果，或打开网址，或将结果复制到剪贴板，这样可以极大地提高我们操作的效率。<br> <br>当然这些默认的功能是不能够满足我们的，还可以通过 Worklow 去扩展效率工具，这里是自己做的一个效率工具箱 xyzUtils ：</p>
<p><img src="/resource/img/efficiency/a9.png" alt="Alfred"></p>
<p>Github 地址： <a target="_blank" rel="noopener" href="https://github.com/noogel/Alfred-Workflow">https://github.com/noogel/Alfred-Workflow</a></p>
<p>这里我做了一些开发中常用的数据转换功能，时间戳与时间的互相转换、Unicode码中文转换、随机字符串生成、IP查询、base64编码解码、MD5生成等，回车复制结果到剪贴板，举例如下：</p>
<p><img src="/resource/img/efficiency/a10.png" alt="Alfred"></p>
<p>网友们还提供了更多的 自定义功能，可自行知乎。</p>
<h2 id="Jietu"><a href="#Jietu" class="headerlink" title="Jietu"></a>Jietu</h2><p><img src="/resource/img/efficiency/j1.png" alt="Jietu"></p>
<p>这个是腾讯提供的免费截图工具，可进行区域截图或者屏幕录制功能，可以快捷编辑截图，也是我常用的一个神器。配置信息如下图：</p>
<p><img src="/resource/img/efficiency/j2.png" alt="Jietu"></p>
<p>截好图后可以按 空格键 进行快速编辑，很是方便，截图后会自动放到剪贴板，可直接粘贴到微信、QQ、Slack等应用的对话框中。</p>
<p><img src="/resource/img/efficiency/j3.png" alt="Jietu"></p>
<p> </p>
<h2 id="Hammerspoon"><a href="#Hammerspoon" class="headerlink" title="Hammerspoon"></a>Hammerspoon</h2><p><img src="/resource/img/efficiency/h1.png" alt="Hammerspoon"></p>
<p>这款神器和上面的 Alfred 功能点有些重合，可以提供快速启动应用、调整窗口大小等功能。通过自定义 Lua 脚本实现所需的功能，这些功能主要通过绑定快捷键实现功能出发，当然也会绑定一些系统事件触发脚本功能。</p>
<p>目前在网上搜集了一些基本功能，调整窗口比例，连接到办公区网络自动静音等功能。</p>
<p><img src="/resource/img/efficiency/h2.png" alt="Hammerspoon"></p>
<p> </p>
<h2 id="Time-Out"><a href="#Time-Out" class="headerlink" title="Time Out"></a>Time Out</h2><p><img src="/resource/img/efficiency/t1.png" alt="Time Out"></p>
<p>这款工具主要是可以帮助久用电脑的人每隔一段时间暂停一下，我这里设置的每隔 50分钟暂停 3分钟，就是在这 3分钟时间这个软件会弹出屏保提醒你稍事休息一下再工作，当然暂停期间是可以随之取消的，暂停的时候就是这个样子的。</p>
<p><img src="/resource/img/efficiency/t2.png" alt="Time Out"></p>
<h2 id="Reeder"><a href="#Reeder" class="headerlink" title="Reeder"></a>Reeder</h2><p>这是一款 Mac 上知名度很高的 RSS 阅读器，简洁的外观与便捷的操作方式可以省去了去个站点看文章。结合Mac 触控板的左右滑动操作还是很方便的。</p>
<p><img src="/resource/img/efficiency/r1.png" alt="Reeder"></p>
<p><img src="/resource/img/efficiency/r2.png" alt="Reeder"></p>
<p>最后，来还有一些常用效率工具会在在后面的文章继续介绍，或许正是你所需要的，敬请期待！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/08/17/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/08/17/1.html" class="post-title-link" itemprop="url">AlfredWorkflow</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-08-17 00:00:00" itemprop="dateCreated datePublished" datetime="2017-08-17T00:00:00+00:00">2017-08-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>开发工程师常用工具箱</p>
<h2 id="全局预览"><a href="#全局预览" class="headerlink" title="全局预览"></a>全局预览</h2><p><img src="/resource/img/Jietu20170817-204623.jpg" alt="1"></p>
<h2 id="支持的命令"><a href="#支持的命令" class="headerlink" title="支持的命令"></a>支持的命令</h2><p><img src="/resource/img/Jietu20170817-204906.jpg" alt="2"></p>
<ul>
<li><code>ntime</code> 时间戳转换，支持标准时间格式与时间戳自动检测转换，回车复制结果到剪贴板</li>
<li><code>nb64d</code> Base64 解码</li>
<li><code>nb64e</code> Base64 编码</li>
<li><code>nmd5</code> MD5 生成</li>
<li><code>ncny</code> 数字转人民币大写</li>
<li><code>nu2c</code> Unicode 码转中文</li>
<li><code>nc2u</code> 中文转 Unicode 码</li>
<li><code>nip</code> IP 地址查询</li>
<li><code>nrdm</code> 随机字符串生成，输入长度</li>
<li><code>nhelp</code> 列出所有支持的命令</li>
</ul>
<h4 id="欢迎大家补充。"><a href="#欢迎大家补充。" class="headerlink" title="欢迎大家补充。"></a>欢迎大家补充。</h4><h2 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h2><p><a href="http://noogel.xyz/">知一的指纹</a></p>
<h2 id="Github"><a href="#Github" class="headerlink" title="Github"></a>Github</h2><p><a target="_blank" rel="noopener" href="https://github.com/noogel/Alfred-Workflow">Noogel’s github Alfred-Workflow</a></p>
<blockquote>
<p>Update at 2017-08-17</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/06/17/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/17/1.html" class="post-title-link" itemprop="url">你的Ubuntu还可以这么美</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-17 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-17T00:00:00+00:00">2017-06-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>先上两张桌面和开发环境见下图<br><img src="/resource/img/Ubuntu/full-screen.png" alt="桌面"><br><img src="/resource/img/Ubuntu/full-dev.png" alt="开发环境"></p>
<h2 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h2><h3 id="更新源"><a href="#更新源" class="headerlink" title="更新源"></a>更新源</h3><p>更新前先设置源为<code>aliyun</code>的，国内访问速度快。</p>
<p><img src="/resource/img/Ubuntu/sys-up.png" alt="更新源"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>

<h3 id="删除Amazon的链接"><a href="#删除Amazon的链接" class="headerlink" title="删除Amazon的链接"></a>删除Amazon的链接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove unity-webapps-common</span><br></pre></td></tr></table></figure>

<h3 id="主题美化"><a href="#主题美化" class="headerlink" title="主题美化"></a>主题美化</h3><p>先装 Unity 图形管理工具<br><img src="/resource/img/Ubuntu/unity.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install unity-tweak-tool</span><br></pre></td></tr></table></figure>

<p>然后安装 Flatabulous 主题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab/themes</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install flatabulous-theme</span><br></pre></td></tr></table></figure>

<p>和配套图标</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:noobslab/icons</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ultra-flat-icons</span><br></pre></td></tr></table></figure>

<p>更换操作如下图：</p>
<p><img src="/resource/img/Ubuntu/unity-them.png"><br><img src="/resource/img/Ubuntu/unity-font.png"></p>
<p>至此主题美化完成</p>
<h3 id="System-Load-Indicator（系统状态指示器）"><a href="#System-Load-Indicator（系统状态指示器）" class="headerlink" title="System Load Indicator（系统状态指示器）"></a>System Load Indicator（系统状态指示器）</h3><p><img src="/resource/img/Ubuntu/sys-m.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:indicator-multiload/stable-daily</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install indicator-multiload</span><br></pre></td></tr></table></figure>

<h3 id="微软雅黑"><a href="#微软雅黑" class="headerlink" title="微软雅黑"></a>微软雅黑</h3><p><a target="_blank" rel="noopener" href="http://www.mycode.net.cn/wp-content/uploads/2015/07/YaHeiConsolas.tar.gz">字体下载</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf YaHeiConsolas.tar.gz</span><br><span class="line">sudo mv YaHeiConsolas.ttf /usr/share/fonts</span><br><span class="line">sudo chmod 755 /usr/share/fonts/YaHeiConsolas.ttf</span><br></pre></td></tr></table></figure>


<h3 id="安装zsh"><a href="#安装zsh" class="headerlink" title="安装zsh"></a>安装zsh</h3><p><img src="/resource/img/Ubuntu/zsh.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zsh</span><br><span class="line">zsh --version</span><br><span class="line">sudo chsh -s $(which zsh)</span><br></pre></td></tr></table></figure>
<p>然后再重新注销登录就好了</p>
<h2 id="必装软件"><a href="#必装软件" class="headerlink" title="必装软件"></a>必装软件</h2><blockquote>
<p>下面介绍的软件有一部分是通过 deb 文件安装的，具体安装方式见 系统使用技巧。</p>
</blockquote>
<h3 id="系统软件"><a href="#系统软件" class="headerlink" title="系统软件"></a>系统软件</h3><ul>
<li>浏览器： Chrome</li>
<li>搜狗输入法： sougoupinyin</li>
<li>为知笔记： wiznote</li>
<li>系统状态指示器： System Load Indicator</li>
<li>SS你懂得： Shadowsocks-Qt5</li>
<li>Unity图形管理工具： unity tweak tool</li>
<li>图片编辑工具： gimp</li>
<li>思维导图： xmind</li>
<li>EPUB文件编辑： sigil</li>
<li>Linux下的Dash： zeal</li>
<li>Linux下Albert： albert</li>
<li>网易云音乐播放器</li>
<li>Robomongo</li>
</ul>
<h3 id="数据库及工具"><a href="#数据库及工具" class="headerlink" title="数据库及工具"></a>数据库及工具</h3><ul>
<li>mysql</li>
<li>mongodb</li>
<li>redis</li>
<li>MySQL Workbench</li>
</ul>
<h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><ul>
<li>Python IDE： Pycharm</li>
</ul>
<h3 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h3><ul>
<li>zsh</li>
<li>oh-my-zsh</li>
<li>vim</li>
<li>git</li>
</ul>
<h2 id="系统使用技巧"><a href="#系统使用技巧" class="headerlink" title="系统使用技巧"></a>系统使用技巧</h2><h3 id="DEB软件安装"><a href="#DEB软件安装" class="headerlink" title="DEB软件安装"></a>DEB软件安装</h3><ul>
<li>安装命令</li>
</ul>
<p><code>sudo dpkg -i xxx.deb</code></p>
<ul>
<li>安装过程中可能会报缺少依赖的错，执行下面命令自动安装依赖</li>
</ul>
<p><code>sudo apt-get install -f</code></p>
<ul>
<li>再次执行安装命令</li>
</ul>
<p><code>sudo dpkg -i xxx.deb</code></p>
<h3 id="卸载不再依赖的包-命令"><a href="#卸载不再依赖的包-命令" class="headerlink" title="卸载不再依赖的包 命令"></a>卸载不再依赖的包 命令</h3><p><code>sudo apt-get autoremove</code></p>
<blockquote>
<p>未完待续，欢迎大家发送你的优化点到我的邮箱 <a href="mailto:&#110;&#111;&#x6f;&#103;&#101;&#x6c;&#x40;&#x31;&#x36;&#x33;&#46;&#x63;&#x6f;&#109;">&#110;&#111;&#x6f;&#103;&#101;&#x6c;&#x40;&#x31;&#x36;&#x33;&#46;&#x63;&#x6f;&#109;</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/05/01/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/05/01/1.html" class="post-title-link" itemprop="url">支付交易系统架构调研</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-05-01 00:00:00" itemprop="dateCreated datePublished" datetime="2017-05-01T00:00:00+00:00">2017-05-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>交易过程：</p>
<ol>
<li>客户下单</li>
<li>客户完成支付</li>
<li>商家接单</li>
<li>商家发货</li>
</ol>
<p>从软件开发角度， 还有一些非功能性需求需要实现：</p>
<ol>
<li>性能： 特别是秒杀的时候，如何满足高频率的支付需求？</li>
<li>可靠性：不用说，系统能达到几个9，是衡量软件设计功力的重要指标。 99%是基础， 99.999%是目标，更多的9哪就是神了。</li>
<li>易用性：支付中多一个步骤，就会流失至少2%的用户。 产品经理都在削尖脑袋想想怎么让用户赶紧掏钱。</li>
<li>可扩展性： 近年来支付业务创新产品多，一元购、红包、打赏等，还有各种的支付场景。 怎么能够快速满足产品经理的需求，尽快上线来抢占市场，可扩展性对支付系统设计也是一个挑战。</li>
<li>可伸缩性：为了支持公司业务，搞一些促销活动是必须的。 那促销带来的爆发流量，最佳应对方法就是加机器了。 平时流量低，用不了那么多机器，该释放的就释放掉了， 给公司省点钱。</li>
</ol>
<p>典型支付系统架构：<br><img src="/resource/img/15135039006989.jpg"></p>
<p>某旅游公司：<br><img src="/resource/img/15135039141413.jpg"></p>
<p>京东金融：<br><img src="/resource/img/15135039244991.jpg"></p>
<p>支付系统一般会提供如下子系统：</p>
<ol>
<li>支付应用和产品.(应用层)： 这是针对各端（PC Web端、android、IOS)的应用和产品。 为各个业务系统提供收银台支持，同时支付作为一个独立的模块，可以提供诸如银行卡管理、理财、零钱、虚拟币管理、交易记录查阅、卡券等功能；</li>
<li>支付运营系统(应用层)： 支付系统从安全的角度来说，有一个重要的要求是，懂代码的不碰线上，管运营的不碰代码。这对运营系统的要求就很高，要求基本上所有线上的问题，都可以通过运营系统来解决。</li>
<li>支付BI系统(应用层): 支付中产生大量的数据，对这些数据进行分析， 有助于公司老板们了解运营状况，进行决策支持。</li>
<li>风控系统(应用层)：这是合规要求的风险控制、反洗钱合规等。</li>
<li>信用信息管理系统(应用层)：用来支持对信用算法做配置，对用户的信用信息做管理。<br>支付系统一般会提供如下子系统：</li>
<li>支付应用和产品.(应用层)： 这是针对各端（PC Web端、android、IOS)的应用和产品。 为各个业务系统提供收银台支持，同时支付作为一个独立的模块，可以提供诸如银行卡管理、理财、零钱、虚拟币管理、交易记录查阅、卡券等功能；</li>
<li>支付运营系统(应用层)： 支付系统从安全的角度来说，有一个重要的要求是，懂代码的不碰线上，管运营的不碰代码。这对运营系统的要求就很高，要求基本上所有线上的问题，都可以通过运营系统来解决。</li>
<li>支付BI系统(应用层): 支付中产生大量的数据，对这些数据进行分析， 有助于公司老板们了解运营状况，进行决策支持。</li>
<li>风控系统(应用层)：这是合规要求的风险控制、反洗钱合规等。</li>
<li>信用信息管理系统(应用层)：用来支持对信用算法做配置，对用户的信用信息做管理。</li>
</ol>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.bijishequ.com/detail/95641">http://www.bijishequ.com/detail/95641</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/03/02/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/03/02/1.html" class="post-title-link" itemprop="url">结算开发中遇到的坑</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-03-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-02T00:00:00+00:00">2017-03-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>坑1：浮点数不精确性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [1]: 0.1+0.1+0.1-0.3</span><br><span class="line">Out[1]: 5.551115123125783e-17</span><br></pre></td></tr></table></figure>
<p>解决办法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [2]: from decimal import Decimal</span><br><span class="line">In [3]: Decimal(&#x27;0.1&#x27;) + Decimal(&#x27;0.1&#x27;) + Decimal(&#x27;0.1&#x27;) - Decimal(&#x27;0.3&#x27;)</span><br><span class="line">Out[3]: Decimal(&#x27;0.0&#x27;)</span><br></pre></td></tr></table></figure>
<p>坑2：Decimal使用问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [5]: Decimal(0.1) + Decimal(0.1) + Decimal(0.1) - Decimal(0.3)</span><br><span class="line">Out[5]: Decimal(&#x27;2.775557561565156540423631668E-17&#x27;)</span><br></pre></td></tr></table></figure>
<p>解决办法：<br>参照坑1的解决办法，Decimal传入值需要str类型<br>更多用法查看：<a target="_blank" rel="noopener" href="https://docs.python.org/2/library/decimal.html">https://docs.python.org/2/library/decimal.html</a></p>
<p>坑3：四舍五入不准确问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [3]: &#x27;&#123;:.2f&#125;&#x27;.format(Decimal(str(1001.8250)))</span><br><span class="line">Out[3]: &#x27;1001.82&#x27;</span><br><span class="line">In [2]: Decimal(&#x27;1001.8250&#x27;).quantize(Decimal(&#x27;0.01&#x27;))</span><br><span class="line">Out[2]: Decimal(&#x27;1001.82&#x27;)</span><br><span class="line">In [4]: round(2.55, 1)</span><br><span class="line">Out[4]: 2.5</span><br></pre></td></tr></table></figure>
<p>解决办法：<br>发现问题原因为在不能正确四舍五入的float数值中都是因为数据存储末位的.5被存储为.4999999…的形式，解决办法是在.5上加.1的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def exact_round(num, exp=2):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    准确的四舍五入方法</span><br><span class="line">    :param num: 数值</span><br><span class="line">    :param exp: 保留精度</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    str_num = str(num)</span><br><span class="line">    dec_num = Decimal(str_num)</span><br><span class="line">    exp_unit = Decimal(&#x27;0.1&#x27;) ** exp</span><br><span class="line">    mini_unit = Decimal(&#x27;0.1&#x27;) ** (exp + 1)</span><br><span class="line">    if dec_num % exp_unit == (5 * mini_unit):</span><br><span class="line">        dec_num += mini_unit</span><br><span class="line">    return Decimal(dec_num).quantize(exp_unit, rounding=ROUND_HALF_EVEN)</span><br></pre></td></tr></table></figure>

<p>为了验证这个方法写了个测试脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">摘    要: exact_round.py</span><br><span class="line">创 建 者: abc</span><br><span class="line">创建日期: 2017-01-05</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">__author__ = &quot;abc&quot;</span><br><span class="line"></span><br><span class="line">from decimal import Decimal, ROUND_HALF_EVEN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def exact_round(num, exp=2):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    准确的四舍五入方法</span><br><span class="line">    :param num: 数值</span><br><span class="line">    :param exp: 保留精度</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    str_num = str(num)</span><br><span class="line">    dec_num = Decimal(str_num)</span><br><span class="line">    exp_unit = Decimal(&#x27;0.1&#x27;) ** exp</span><br><span class="line">    mini_unit = Decimal(&#x27;0.1&#x27;) ** (exp + 1)</span><br><span class="line">    raw_num = dec_num</span><br><span class="line">    if dec_num % exp_unit == (5 * mini_unit):</span><br><span class="line">        dec_num += mini_unit</span><br><span class="line">    raw_result = Decimal(raw_num).quantize(exp_unit, rounding=ROUND_HALF_EVEN)</span><br><span class="line">    result = Decimal(dec_num).quantize(exp_unit, rounding=ROUND_HALF_EVEN)</span><br><span class="line">    if result != raw_result:</span><br><span class="line">        print &quot;raw:round(&#123;&#125;, &#123;&#125;) = &gt; &#123;&#125;; fixed: round(&#123;&#125;, &#123;&#125;) =&gt; &#123;&#125;&quot;.format(</span><br><span class="line">            raw_num, exp, raw_result,</span><br><span class="line">            dec_num, exp, result</span><br><span class="line">        )</span><br><span class="line">    return result</span><br><span class="line"> </span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    val = 900.0000</span><br><span class="line">    while val &lt; 1001.8600:</span><br><span class="line">        for exp in range(0, 6):</span><br><span class="line">            exact_round(val, exp=exp)</span><br><span class="line">        val += 0.0005</span><br></pre></td></tr></table></figure>
<p>脚本中我们将被修正过的数据打印出来，发现被打印出来的都是四舍五入不正确的数值，经过方法处理可以保证准确的输出。</p>
<p>因为我们的测试只是覆盖了部分的数值，精度深度也只到到了6位，也不能保证说方法没有问题。<br>后来询问了在银行做开发的朋友，他们对于数据的计算都是在数据库的存储过程中运算的，并对上面坑中的数值放到数据库中做四舍五入发现确实没有问题。</p>
<p>于是我将这个方法做的运算与数据库的运算结果做对比写了测试脚本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">摘    要: test_db_round.py</span><br><span class="line">创 建 者: abc</span><br><span class="line">创建日期: 2017-01-06</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">__author__ = &quot;abc&quot;</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">sys.path.append(os.path.dirname(os.path.split(os.path.realpath(__file__))[0]))</span><br><span class="line"></span><br><span class="line">from lib.utils import exact_round</span><br><span class="line">from model import Model</span><br><span class="line"> </span><br><span class="line">def test_db_round(val, exp):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    test_db_round</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    sql = &quot;SELECT round(&#123;&#125;, &#123;&#125;) as val&quot;.format(str(val), exp)</span><br><span class="line">    db_round = Model().raw(sql)[0][&quot;val&quot;]</span><br><span class="line">    exa_round = exact_round(val, exp)</span><br><span class="line">    if str(db_round) != str(exa_round):</span><br><span class="line">        print &quot;db:&#123;&#125;; ex:&#123;&#125;&quot;.format(str(db_round), str(exa_round))</span><br><span class="line"> </span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    val = 900.0000</span><br><span class="line">    while val &lt; 1001.8600:</span><br><span class="line">        for exp in range(0, 6):</span><br><span class="line">            test_db_round(val, exp=exp)</span><br><span class="line">        val += 0.0005</span><br></pre></td></tr></table></figure>
<p>经过测试后发现没有数据被打印出，证明在测试范围内Python方法和数据库的运算结果没有差异。</p>
<p>关于浮点数不精确性的事情相信学过计算机组成原理这门课程的都明白，这里不再赘述，放个链接：<br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/kubixuesheng/p/4107309.html">从如何判断浮点数是否等于0说起——浮点数的机器级表示</a></p>
<p>话说为什么要在Python中做财务相关运算呢，可能最初开发这个系统的人缺乏这方面的经验，然后通过扩展精度保留位数来解决这个问题的，但终究在做四舍五入时可能产生1分的差异。<br>既然发现这个问题，本着眼里不揉沙子的态度，快速的解决方案是在Python中替换原来的四舍五入函数，长期策略是逐步将计算过程挪到数据库通过存储过程来实现。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/01/31/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/01/31/1.html" class="post-title-link" itemprop="url">Xpath总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-01-31 00:00:00" itemprop="dateCreated datePublished" datetime="2017-01-31T00:00:00+00:00">2017-01-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>Firefox + Firepath、Chrome + XPath Helper</li>
<li>常用xpath例子</li>
<li>Python 使用XPath匹配页面数据</li>
<li>参考</li>
</ol>
<hr>
<h2 id="Firefox-Firepath、Chrome-XPath-Helper"><a href="#Firefox-Firepath、Chrome-XPath-Helper" class="headerlink" title="Firefox + Firepath、Chrome + XPath Helper"></a>Firefox + Firepath、Chrome + XPath Helper</h2><p>如下图 Firefox下，XPath需要通过Firebug + Firepath来方便的获取。<br><img src="/resource/img/firefox_xpath.png" alt="firefox xpath"></p>
<p>Chrome下，通过XPath Helper插件实现，开启和关闭快捷键<code>Ctrl + Shift + X</code>,按住<code>Shift</code>键获取。<br><img src="/resource/img/chrome_xpathhelper.png" alt="chrome xpath heloer"></p>
<p>以上两种方式还是Firefox下使用比较方便，更多用法自行发掘。</p>
<h2 id="常用xpath例子"><a href="#常用xpath例子" class="headerlink" title="常用xpath例子"></a>常用xpath例子</h2><p>根据字符串匹配节点，通过<code>contains()</code>、<code>text()</code>匹配<br><code>.//*[@id=&#39;detail_all&#39;]/div[1]/ul/li[contains(text(), &#39;字 数：&#39;)]/text()</code></p>
<p>节点属性不包含**字符串，通过<code>not()</code>、<code>contains()</code>匹配<br><code>.//*[@id=&#39;con_ListStyleTab4A_1&#39;]/p[not(contains(@class, &#39;title&#39;))]/a[@class=&#39;Author&#39;]/text()</code></p>
<p>截取字符串匹配<br><code>substring-before(//div[@class=&#39;content&#39;]/ul/li[6],&#39;,&#39;)</code><br><code>substring(.//h2/../p/span[contains(text(), &#39;字数：&#39;)]/text(), &#39;4&#39;)</code></p>
<p>索引匹配末尾节点，通过<code>last()</code>匹配<br><code>.//div[last()]/div[@class=&#39;show_info_right max_width&#39;]/text()</code></p>
<p>通过<code>..</code>向上级查找匹配<br><code>.//h1/../div[@class=&#39;booksub&#39;]/span/span/text()</code></p>
<p>获取过个节点下的内容，通过<code>//node()/text()</code>可以获取当前节点及其子节点的内容。<br><code>.//*[@id=&#39;job_detail&#39;]/dd[@class=&#39;job-advantage&#39;]//node()/text()</code></p>
<p>有的时候页面中一系列数据下面并不一定包含某些字段，这时我们通过<code>contains()</code>来匹配包含某些关键字的节点来寻找对应的另一个节点。<br><code>.//div[@class=&#39;infobox&#39;]//node()[contains(text(), &#39;户型&#39;)]/../node()/text()</code></p>
<p>这里总结一点使用技巧，更多的关于XPath的方法可以看参考中的链接，足以解决大部分问题。</p>
<h2 id="Python-使用XPath匹配页面数据"><a href="#Python-使用XPath匹配页面数据" class="headerlink" title="Python 使用XPath匹配页面数据"></a>Python 使用XPath匹配页面数据</h2><p>对于爬虫抓取中XPath是一种比较高效的获取数据的方式，在各个爬虫框架中也很多的使用到，具体的用法大致相同，细微之处可自行摸索。以下是最简单的一种方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: abc</span></span><br><span class="line"><span class="string">@file: xpath_demo.py</span></span><br><span class="line"><span class="string">@date: 2017-02-04</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lxml.html</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://noogel.xyz&quot;</span></span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    doc = lxml.html.document_fromstring(res.content)</span><br><span class="line">    title_xpath = <span class="string">&quot;.//header[@id=&#x27;header&#x27;]//a[@class=&#x27;brand&#x27;]/span[@class=&#x27;site-title&#x27;]&quot;</span></span><br><span class="line">    <span class="built_in">print</span> doc.xpath(title_xpath)[<span class="number">0</span>].text</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>XPath是我在做爬虫任务时接触的，这只是整个环节中的一小部分，关于爬虫的一些抓取技巧（动态页面抓取、数据清洗、任务调度等）请关注博客后续更新的文章。</p>
<hr>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/barney/archive/2009/04/17/1438062.html">http://www.cnblogs.com/barney/archive/2009/04/17/1438062.html</a><br><a target="_blank" rel="noopener" href="http://www.w3school.com.cn/xpath/xpath_functions.asp">http://www.w3school.com.cn/xpath/xpath_functions.asp</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/01/24/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/01/24/1.html" class="post-title-link" itemprop="url">Hexo用法汇总</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-01-24 00:00:00" itemprop="dateCreated datePublished" datetime="2017-01-24T00:00:00+00:00">2017-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><h3 id="Hexo-简单、快速、强大的Node-js静态博客框架"><a href="#Hexo-简单、快速、强大的Node-js静态博客框架" class="headerlink" title="Hexo:简单、快速、强大的Node.js静态博客框架"></a>Hexo:简单、快速、强大的Node.js静态博客框架</h3><h3 id="NPM：NodeJS包管理工具"><a href="#NPM：NodeJS包管理工具" class="headerlink" title="NPM：NodeJS包管理工具"></a>NPM：NodeJS包管理工具</h3><h3 id="淘宝NPM镜像"><a href="#淘宝NPM镜像" class="headerlink" title="淘宝NPM镜像"></a>淘宝NPM镜像</h3><p><a target="_blank" rel="noopener" href="https://npm.taobao.org/">https://npm.taobao.org/</a></p>
<p>直接使用：<code>npm install -g cnpm --registry=https://registry.npm.taobao.org</code></p>
<p>alias使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">alias cnpm=&quot;npm --registry=https://registry.npm.taobao.org \</span><br><span class="line">--cache=$HOME/.npm/.cache/cnpm \</span><br><span class="line">--disturl=https://npm.taobao.org/dist \</span><br><span class="line">--userconfig=$HOME/.cnpmrc&quot;</span><br><span class="line"></span><br><span class="line"># Or alias it in .bashrc or .zshrc</span><br><span class="line">$ echo &#x27;\n#alias for cnpm\nalias cnpm=&quot;npm --registry=https://registry.npm.taobao.org \</span><br><span class="line">  --cache=$HOME/.npm/.cache/cnpm \</span><br><span class="line">  --disturl=https://npm.taobao.org/dist \</span><br><span class="line">  --userconfig=$HOME/.cnpmrc&quot;&#x27; &gt;&gt; ~/.zshrc &amp;&amp; source ~/.zshrc</span><br></pre></td></tr></table></figure>

<p>Hexo安装，<code>-g</code>全局安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g</span><br></pre></td></tr></table></figure>

<h3 id="博客创建"><a href="#博客创建" class="headerlink" title="博客创建"></a>博客创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init noogel</span><br></pre></td></tr></table></figure>

<h3 id="扩展插件安装"><a href="#扩展插件安装" class="headerlink" title="扩展插件安装"></a>扩展插件安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-server --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-admin --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-generator-archive --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-generator-feed --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-generator-search --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-generator-tag --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-deployer-git --save --registry=https://registry.npm.taobao.org</span><br><span class="line">sudo npm install hexo-generator-sitemap --save --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>之后新的机器部署环境可以直接 <code>sudo npm install --registry=https://registry.npm.taobao.org</code><br>会自动读取 package.json 文件进行安装</p>
<h3 id="服务启动，两种命令"><a href="#服务启动，两种命令" class="headerlink" title="服务启动，两种命令"></a>服务启动，两种命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo serve</span><br><span class="line">hexo s -g</span><br></pre></td></tr></table></figure>

<h3 id="一键发布到git"><a href="#一键发布到git" class="headerlink" title="一键发布到git"></a>一键发布到git</h3><ol>
<li>修改<code>_config.yml</code>配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  # 类型</span><br><span class="line">  type: git</span><br><span class="line">  # 仓库</span><br><span class="line">  repo: git@github.com:noogel/noogel.github.io.git</span><br><span class="line">  # 分支</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></li>
<li>发布命令<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d -g</span><br></pre></td></tr></table></figure></li>
<li>清除发布结果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure></li>
</ol>
<p>组合命令：<code>alias hexod=&quot;hexo d -g &amp;&amp; hexo clean&quot;</code></p>
<h3 id="添加tags"><a href="#添加tags" class="headerlink" title="添加tags"></a>添加tags</h3><p>执行<code>hexo new page &quot;tags&quot;</code>，然后编辑<code>source/tags/index.md</code></p>
<h3 id="配置修改"><a href="#配置修改" class="headerlink" title="配置修改"></a>配置修改</h3><p>博客配置修改<code>_config.yml</code>，主题配置修改<code>themes/&lt;themes&gt;/_config.yml</code></p>
<h3 id="hexo自动提交命令"><a href="#hexo自动提交命令" class="headerlink" title="hexo自动提交命令"></a>hexo自动提交命令</h3><p>这里设置了一个自动提交的命令，源码自动提交到 sources 分支</p>
<p><code>alias hexodp=&quot;hexo d -g &amp;&amp; git add --all &amp;&amp; git commit -am &#39;auto commit&#39; &amp;&amp; git push origin sources&quot;</code></p>
<h3 id="hexo-admin-管理文章"><a href="#hexo-admin-管理文章" class="headerlink" title="hexo-admin 管理文章"></a>hexo-admin 管理文章</h3><p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-admin --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<p>打开 <a target="_blank" rel="noopener" href="http://localhost:4000/admin/">http://localhost:4000/admin/</a></p>
<p>然后可以在里面配置登录账号密码，并添加到 _config.yml 文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># hexo-admin authentification</span><br><span class="line">admin:</span><br><span class="line">  username: noogel</span><br><span class="line">  password_hash: $2a$10$CMR/GX.e6TuoGGOYOF7ks.R.WmSUC8RvelPPXIH5wV3S6hPLYPnx6</span><br><span class="line">  secret: a33x8sd83ndfus82jrfi8sj28djk438ds</span><br></pre></td></tr></table></figure>

<p>预览界面如下：<br><img src="/resource/img/hexo-admin.png" alt="hexo-admin"></p>
<h3 id="hexo常见问题解决办法"><a href="#hexo常见问题解决办法" class="headerlink" title="hexo常见问题解决办法"></a>hexo常见问题解决办法</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">https://hexo.io/docs/troubleshooting.html</a><br><a target="_blank" rel="noopener" href="http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html">http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html</a><br><a target="_blank" rel="noopener" href="https://donlex.cn/archives/55e73569.html">https://donlex.cn/archives/55e73569.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2016/12/28/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/28/1.html" class="post-title-link" itemprop="url">k近邻法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-28 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-28T00:00:00+00:00">2016-12-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简单解释：采用测量不同特征值之间距离的方法进行分类的算法。<br>主要优点是精度高，缺点是计算和空间负责度高，适用于数值型和标称型。<br>已下是通过Python实现的k-近邻算法，大致思路是计算样本数据<code>data_set</code>中的点与待分类点的距离，按距离递增排序，然后取出前K个点，计算这些点所属标签的数量，计数最高的标签为分类结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /data/server/python/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">k-近邻算法</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">knn</span>(<span class="params">position, data_set, labels, k</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    k-近邻算法</span></span><br><span class="line"><span class="string">    :param position: 待分类点</span></span><br><span class="line"><span class="string">    :param data_set: 数据样本</span></span><br><span class="line"><span class="string">    :param labels: 标签集合</span></span><br><span class="line"><span class="string">    :param k: 取值</span></span><br><span class="line"><span class="string">    :return: 所属标签</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    distance_list = []</span><br><span class="line">    <span class="keyword">for</span> index, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_set):</span><br><span class="line">        distance_list.append((</span><br><span class="line">            labels[index],</span><br><span class="line">            math.sqrt(reduce(operator.add, [(v - position[i]) ** <span class="number">2</span> <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(item)]))</span><br><span class="line">        ))</span><br><span class="line">    distance_list = <span class="built_in">sorted</span>(distance_list, key=<span class="keyword">lambda</span> x: x, reverse=<span class="literal">True</span>)</span><br><span class="line">    result = Counter([val[<span class="number">0</span>] <span class="keyword">for</span> val <span class="keyword">in</span> distance_list[:k]])</span><br><span class="line">    result_labels = <span class="built_in">sorted</span>(result.items(), <span class="keyword">lambda</span> x, y: cmp(x[<span class="number">1</span>], y[<span class="number">1</span>]), reverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> result_labels[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    point = [<span class="number">0.2</span>, <span class="number">0.3</span>]</span><br><span class="line">    data_set = [[<span class="number">1</span>, <span class="number">1.1</span>], [<span class="number">1</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0.1</span>]]</span><br><span class="line">    labels = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]</span><br><span class="line">    k = <span class="number">3</span></span><br><span class="line">    <span class="built_in">print</span> knn(point, data_set, labels, k)</span><br></pre></td></tr></table></figure>

<h3 id="k-d-tree算法"><a href="#k-d-tree算法" class="headerlink" title="k-d tree算法"></a>k-d tree算法</h3><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/eyeszjwang/articles/2429382.html">http://www.cnblogs.com/eyeszjwang/articles/2429382.html</a></p>
</blockquote>
<hr>
<p><strong>k近邻法</strong> 给定一个训练数据集，对新输入的实例，在训练的数据集中找到与该实例最近邻的k个实例，这k个实例的多数属于某个类，就把该输入实例分为这个类。</p>
<p><strong>kd树</strong> 是一种对k维空间中的实例点进行存储以便对其进行快速检索的树形数据结构。</p>
<h5 id="算法：（构造平衡kd树）"><a href="#算法：（构造平衡kd树）" class="headerlink" title="算法：（构造平衡kd树）"></a>算法：（构造平衡kd树）</h5><p>输入：k维空间数据集<br>$$ T&#x3D;{x_1,x_2,…,x_N} $$,<br>$$ x_i&#x3D;(x_i^{(1)},x_i^{(2)},…,x_i^{(k)})^T, i&#x3D;1,2,…,N; $$</p>
<p>输出：kd树。</p>
<h5 id="生成："><a href="#生成：" class="headerlink" title="生成："></a>生成：</h5><p>从深度为0的结点开始。重复对深度为j的结点，选择<code>x(l)</code>为切分的坐标轴，<code>l=j(mode k) + 1</code>，以该结点的区域中所有实例的<code>x(l)</code>坐标的中位数为切分点，将该结点对应的超矩形区域切分为两个子区域。切分由通过切分点并与坐标轴<code>x(l)</code>垂直的超平面实现。由该结点生成深度为j+1的左、右子结点：左子节点对应坐标<code>x(l)</code>小于切分点的子区域，右子节点对应坐标<code>x(l)</code>大于切分点的子区域。</p>
<h5 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h5><p>对以下给定二维数据集构造一个平衡kd树<br>$$ T&#x3D; {(2,3)^T, (5,4)^T, (9,6)^T, (4,7)^T, (8,1)^T, (7,2)^T } $$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2016/12/15/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/12/15/1.html" class="post-title-link" itemprop="url">余弦相似度分类</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2016-12-15T00:00:00+00:00">2016-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>计算余弦值公式<br>$$cos\theta &#x3D; \frac{x_1y_1+x_2y_2+…+x_ny_n}{\sqrt{x_1^2+x_2^2+…+x_n^2}\sqrt{y_1^2+y_2^2+…+y_n^2}}$$</p>
<p>样本和待分类图像</p>
<p><img src="/resource/img/9ce24513b3daf2d8.png" alt="样本和待分类图像"></p>
<p>执行结果</p>
<p><img src="/resource/img/e1c67f947d03a7db.png" alt="执行结果"></p>
<p>完整代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@author: abc</span></span><br><span class="line"><span class="string">@file: euclidean_distance.py</span></span><br><span class="line"><span class="string">@date: 2016-12-09</span></span><br><span class="line"><span class="string">@desc: 余弦相似度</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;abc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">w_fg = <span class="number">20</span></span><br><span class="line">h_fg = <span class="number">15</span></span><br><span class="line">pic_flag = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_pic</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    read_pic</span></span><br><span class="line"><span class="string">    :param fn:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    fnimg = cv2.imread(fn)</span><br><span class="line">    img = cv2.resize(fnimg, (<span class="number">800</span>, <span class="number">600</span>), interpolation=cv2.INTER_AREA)</span><br><span class="line">    w = img.shape[<span class="number">1</span>]</span><br><span class="line">    h = img.shape[<span class="number">0</span>]</span><br><span class="line">    w_interval = w / w_fg</span><br><span class="line">    h_interval = h / h_fg</span><br><span class="line"></span><br><span class="line">    alltz = []</span><br><span class="line">    alltz.append([])</span><br><span class="line">    alltz.append([])</span><br><span class="line">    alltz.append([])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> now_h <span class="keyword">in</span> xrange(<span class="number">0</span>, h, h_interval):</span><br><span class="line">        <span class="keyword">for</span> now_w <span class="keyword">in</span> xrange(<span class="number">0</span>, w, w_interval):</span><br><span class="line">            b = img[now_h:now_h + h_interval, now_w:now_w + w_interval, <span class="number">0</span>]</span><br><span class="line">            g = img[now_h:now_h + h_interval, now_w:now_w + w_interval, <span class="number">1</span>]</span><br><span class="line">            r = img[now_h:now_h + h_interval, now_w:now_w + w_interval, <span class="number">2</span>]</span><br><span class="line">            btz = np.mean(b)</span><br><span class="line">            gtz = np.mean(g)</span><br><span class="line">            rtz = np.mean(r)</span><br><span class="line"></span><br><span class="line">            alltz[<span class="number">0</span>].append(btz)</span><br><span class="line">            alltz[<span class="number">1</span>].append(gtz)</span><br><span class="line">            alltz[<span class="number">2</span>].append(rtz)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> alltz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cossimi</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    get_cossimi</span></span><br><span class="line"><span class="string">    :param x:</span></span><br><span class="line"><span class="string">    :param y:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    myx = np.array(x)</span><br><span class="line">    myy = np.array(y)</span><br><span class="line">    cos1 = np.<span class="built_in">sum</span>(myx * myy)</span><br><span class="line">    cos21 = np.sqrt(<span class="built_in">sum</span>(myx * myx))</span><br><span class="line">    cos22 = np.sqrt(<span class="built_in">sum</span>(myy * myy))</span><br><span class="line">    <span class="keyword">return</span> cos1 / <span class="built_in">float</span>(cos21 * cos22)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 提取特征</span></span><br><span class="line">    train_x = []</span><br><span class="line">    d = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> xrange(<span class="number">1</span>, pic_flag + <span class="number">1</span>):</span><br><span class="line">        smp_x = []</span><br><span class="line">        b_tz = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        g_tz = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        r_tz = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">        mytz = np.zeros((<span class="number">3</span>, w_fg * h_fg))</span><br><span class="line">        <span class="keyword">for</span> jj <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">3</span>):</span><br><span class="line">            fn = <span class="string">&#x27;/home/abc/Projects/machine_learning/img/base/p&#x27;</span> + <span class="built_in">str</span>(ii) + <span class="string">&#x27;-&#x27;</span> + <span class="built_in">str</span>(jj) + <span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">            <span class="built_in">print</span> fn</span><br><span class="line">            tmptz = read_pic(fn)</span><br><span class="line">            mytz += np.array(tmptz)</span><br><span class="line">        mytz /= <span class="number">3</span></span><br><span class="line">        train_x.append(mytz[<span class="number">0</span>].tolist() + mytz[<span class="number">1</span>].tolist() + mytz[<span class="number">2</span>].tolist())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        fn = <span class="string">&#x27;/home/abc/Projects/machine_learning/img/base/test&#123;&#125;.jpg&#x27;</span>.<span class="built_in">format</span>(index)</span><br><span class="line">        testtz = np.array(read_pic(fn))</span><br><span class="line">        simtz = testtz[<span class="number">0</span>].tolist() + testtz[<span class="number">1</span>].tolist() + testtz[<span class="number">2</span>].tolist()</span><br><span class="line">        maxtz = <span class="number">0</span></span><br><span class="line">        nowi = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(pic_flag):</span><br><span class="line">            nowsim = get_cossimi(train_x[i], simtz)</span><br><span class="line">            <span class="keyword">if</span> nowsim &gt; maxtz:</span><br><span class="line">                maxtz = nowsim</span><br><span class="line">                nowi = i</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;%s属于第%d类&#x27;</span> % (fn, nowi + <span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/chaosimple/archive/2013/06/28/3160839.html">http://www.cnblogs.com/chaosimple/archive/2013/06/28/3160839.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">noogel</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js","integrity":"sha256-96rwDGMWIQYB0yKGp1sKi1yrjrLPj2oT39IpbCsIrsg="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"noogel","repo":"noogel.github.io","client_id":"41a4e14aca0b3552334a","client_secret":"ebe0f9bfd24824f3d0d0f41bfd88a8736353759b","admin_user":"noogel","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"f96e384362e35929e7a2ca2c30b19531"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
