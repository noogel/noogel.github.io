<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 7.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/resource/img/favicon2018.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/resource/img/favicon2018.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/resource/img/favicon2018.png">
  <link rel="mask-icon" href="/resource/img/favicon2018.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"noogel.xyz","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="MySQL 大小写区分问题 sql_mode 配置Modes affect the SQL syntax MySQL supports and the data validation checks it performs. This makes it easier to use MySQL in different environments and to use MySQL together wi">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL一些零散记录">
<meta property="og:url" content="https://noogel.xyz/2017/12/17/1.html">
<meta property="og:site_name" content="知一杂谈">
<meta property="og:description" content="MySQL 大小写区分问题 sql_mode 配置Modes affect the SQL syntax MySQL supports and the data validation checks it performs. This makes it easier to use MySQL in different environments and to use MySQL together wi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://noogel.xyz/resource/img/15135036470309.jpg">
<meta property="article:published_time" content="2017-12-17T00:00:00.000Z">
<meta property="article:modified_time" content="2025-07-23T07:30:58.914Z">
<meta property="article:author" content="noogel">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://noogel.xyz/resource/img/15135036470309.jpg">


<link rel="canonical" href="https://noogel.xyz/2017/12/17/1.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://noogel.xyz/2017/12/17/1.html","path":"2017/12/17/1.html","title":"MySQL一些零散记录"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MySQL一些零散记录 | 知一杂谈</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?9cdc9a11cbd242c6336b07c464d8820c"></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="知一杂谈" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">知一杂谈</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">我思故我在</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-career"><a href="/career/" rel="section"><i class="sitemap fa-fw"></i>├ 技术</a></li>
        <li class="menu-item menu-item-life"><a href="/life/" rel="section"><i class="sitemap fa-fw"></i>├ 生活</a></li>
        <li class="menu-item menu-item-future"><a href="/future/" rel="section"><i class="sitemap fa-fw"></i>└ 未来</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E5%A4%A7%E5%B0%8F%E5%86%99%E5%8C%BA%E5%88%86%E9%97%AE%E9%A2%98"><span class="nav-number">1.</span> <span class="nav-text">MySQL 大小写区分问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sql-mode-%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">sql_mode 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dsql-mode"><span class="nav-number">2.1.</span> <span class="nav-text">查看当前sql_mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8Dsql-mode"><span class="nav-number">2.2.</span> <span class="nav-text">设置当前sql_mode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Full-list-of-SQL-Models"><span class="nav-number">2.3.</span> <span class="nav-text">Full list of SQL Models</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#x2F-40001-SQL-NO-CACHE-x2F"><span class="nav-number">3.</span> <span class="nav-text">&#x2F;*!40001 SQL_NO_CACHE *&#x2F;</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E9%94%81%E8%A1%A8%E7%A7%8D%E7%B1%BB"><span class="nav-number">4.</span> <span class="nav-text">MySQL 锁表种类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AD%89%E5%BE%85%E9%94%81%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98"><span class="nav-number">5.</span> <span class="nav-text">等待锁超时问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E8%AF%AD%E5%8F%A5%E6%AD%BB%E9%94%81%E9%97%AE%E9%A2%98"><span class="nav-number">6.</span> <span class="nav-text">插入语句死锁问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E5%8A%A0%E9%94%81%E5%A4%B1%E8%B4%A5%E5%92%8C%E5%8F%91%E7%94%9F%E6%AD%BB%E9%94%81%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">7.</span> <span class="nav-text">避免加锁失败和发生死锁的注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E4%BA%8B%E5%8A%A1"><span class="nav-number">8.</span> <span class="nav-text">MySQL 事务</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">noogel</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/noogel" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;noogel" rel="noopener" target="_blank"><i class="github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:noogel@163.com" title="E-Mail → mailto:noogel@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i></a>
      </span>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://noogel.xyz/2017/12/17/1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="noogel">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="知一杂谈">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL一些零散记录
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-17 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-17T00:00:00+00:00">2017-12-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="MySQL-大小写区分问题"><a href="#MySQL-大小写区分问题" class="headerlink" title="MySQL 大小写区分问题"></a>MySQL 大小写区分问题</h2><p><img src="/resource/img/15135036470309.jpg"></p>
<h2 id="sql-mode-配置"><a href="#sql-mode-配置" class="headerlink" title="sql_mode 配置"></a>sql_mode 配置</h2><p>Modes affect the SQL syntax MySQL supports and the data validation checks it performs. This makes it easier to use MySQL in different environments and to use MySQL together with other database servers.</p>
<h3 id="查看当前sql-mode"><a href="#查看当前sql-mode" class="headerlink" title="查看当前sql_mode"></a>查看当前sql_mode</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT @@GLOBAL.sql_mode;</span><br><span class="line">SELECT @@SESSION.sql_mode;</span><br></pre></td></tr></table></figure>

<h3 id="设置当前sql-mode"><a href="#设置当前sql-mode" class="headerlink" title="设置当前sql_mode"></a>设置当前sql_mode</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL sql_mode = &#x27;modes...&#x27;;</span><br><span class="line">SET SESSION sql_mode = &#x27;modes...&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="Full-list-of-SQL-Models"><a href="#Full-list-of-SQL-Models" class="headerlink" title="Full list of SQL Models"></a>Full list of SQL Models</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html">https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html</a></p>
<h2 id="x2F-40001-SQL-NO-CACHE-x2F"><a href="#x2F-40001-SQL-NO-CACHE-x2F" class="headerlink" title="&#x2F;*!40001 SQL_NO_CACHE *&#x2F;"></a>&#x2F;*!40001 SQL_NO_CACHE *&#x2F;</h2><p><code>/*!  */</code> 这是 mysql 里的语法，并非注释，<code>!</code> 后面是版本号，如果本数据库等于或大于此版本号，那么注释内的代码也会执行。</p>
<p>关于这个条件的问答： <a target="_blank" rel="noopener" href="https://lists.mysql.com/mysql/203373">https://lists.mysql.com/mysql/203373</a></p>
<h2 id="MySQL-锁表种类"><a href="#MySQL-锁表种类" class="headerlink" title="MySQL 锁表种类"></a>MySQL 锁表种类</h2><p>常见的有行锁和表锁。表锁会锁住整张表，并发能力弱，开发中要避免使用表级锁。行锁只将单行数据锁住，锁数据期间对其它行数据不影响，并发能力高，一般使用行锁来处理并发事务。<br>MySQL是如何加不同类型的锁的？对于加锁数据的筛选条件，有其对应的索引建立，MySQL可以快速定位的数据进行行级加锁；而对于没有索引的情况，MySQL 的做法是会先锁住整张表，然后再去获取数据，然后将不满足条件的数据锁释放掉。</p>
<h2 id="等待锁超时问题"><a href="#等待锁超时问题" class="headerlink" title="等待锁超时问题"></a>等待锁超时问题</h2><p><em>Lock wait timeout exceeded; try restarting transaction</em><br>一种情况是因为有操作语句对整个表加锁了，这里发现的例子是在开启事务做 UPDATE 更新时发现的，UPDATE 条件如果不是主键或者没有索引则会锁整张表，只有以主键为条件或完全匹配的唯一索引做更新才是行级锁。<br>还有就是另一个事务中持有锁时间过长导致。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM INNODB_TRX;  // 查看事务表锁状态</span><br><span class="line"></span><br><span class="line">// 创建事务，更新语句，但是不提交</span><br><span class="line">SET SESSION AUTOCOMMIT=off;</span><br><span class="line">BEGIN;</span><br><span class="line">UPDATE tabl1 SET status=1 WHERE expired_at &lt;123456 AND expired_at &gt;= 12346 AND `status` = 0;</span><br></pre></td></tr></table></figure>
<p>这时候再去提交则会报等待锁超时问题。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.toniz.net/?p=556">http://www.toniz.net/?p=556</a></p>
</blockquote>
<p>加行锁的注意事项：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/u014453898/article/details/56068841">http://blog.csdn.net/u014453898/article/details/56068841</a></p>
</blockquote>
<h2 id="插入语句死锁问题"><a href="#插入语句死锁问题" class="headerlink" title="插入语句死锁问题"></a>插入语句死锁问题</h2><p>在 INSERT 语句中出现 <em>Deadlock found when trying to get lock; try restarting transaction</em> 是因为范围匹配加锁是对索引页加锁了，导致其它事务插入数据时报死锁。处理办法是查询改成行锁，以 ID 或唯一索引加锁。</p>
<blockquote>
<p>这里需要强调的是尽量避免使用范围加锁。最好是通过主键加行锁处理。</p>
</blockquote>
<h2 id="避免加锁失败和发生死锁的注意事项"><a href="#避免加锁失败和发生死锁的注意事项" class="headerlink" title="避免加锁失败和发生死锁的注意事项"></a>避免加锁失败和发生死锁的注意事项</h2><ol>
<li>减少锁占用时间，避免拿锁时做过多耗时操作。</li>
<li>加锁条件需对应加索引，尽量为行级锁。</li>
<li>避免死锁需要再开启事务后一次将所需资源加锁，处理后及时 COMMIT 释放锁。</li>
<li>对于请求的网络资源，首先将所需外部资源准备好。</li>
</ol>
<ul>
<li>对于开启事物后加锁，只有 COMMIT 后方可释放锁</li>
<li>在捕获异常中的处理，在捕获异常后要记得 ROLLBACK</li>
<li>等待锁超时时间一般设置在 1-2 秒时间 <code>SET innodb_lock_wait_timeout=1</code>。</li>
</ul>
<h2 id="MySQL-事务"><a href="#MySQL-事务" class="headerlink" title="MySQL 事务"></a>MySQL 事务</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/zhaoyangjian724/article/details/52858519">http://blog.csdn.net/zhaoyangjian724/article/details/52858519</a></p>
</blockquote>
<p>先非主键范围加锁<br>查看事务状态<br>插入区分度高的数据-成功<br>插入区分度低的数据-失败<br>查看引擎状态，发现页锁<br>改为以主键做查询条件加锁<br>插入区分度低的数据-成功</p>
<p>SELECT * FROM INNODB_TRX;</p>
<p>SHOW ENGINE INNODB STATUS;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">=====================================</span><br><span class="line">2017-12-18 11:47:27 7fd5dd6f6700 INNODB MONITOR OUTPUT</span><br><span class="line">=====================================</span><br><span class="line">Per second averages calculated from the last 57 seconds</span><br><span class="line">-----------------</span><br><span class="line">BACKGROUND THREAD</span><br><span class="line">-----------------</span><br><span class="line">srv_master_thread loops: 22630 srv_active, 0 srv_shutdown, 15047550 srv_idle</span><br><span class="line">srv_master_thread log flush and writes: 15067795</span><br><span class="line">----------</span><br><span class="line">SEMAPHORES</span><br><span class="line">----------</span><br><span class="line">OS WAIT ARRAY INFO: reservation count 21761</span><br><span class="line">OS WAIT ARRAY INFO: signal count 42765</span><br><span class="line">Mutex spin waits 38129, rounds 296291, OS waits 3638</span><br><span class="line">RW-shared spins 25778, rounds 578697, OS waits 16634</span><br><span class="line">RW-excl spins 4632, rounds 145148, OS waits 1184</span><br><span class="line">Spin rounds per wait: 7.77 mutex, 22.45 RW-shared, 31.34 RW-excl</span><br><span class="line">------------</span><br><span class="line">TRANSACTIONS</span><br><span class="line">------------</span><br><span class="line">Trx id counter 167458</span><br><span class="line">Purge done for trx&#x27;s n:o &lt; 167444 undo n:o &lt; 0 state: running but idle</span><br><span class="line">History list length 942</span><br><span class="line">LIST OF TRANSACTIONS FOR EACH SESSION:</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2700260, OS thread handle 0x7fd5dd6f6700, query id 16186792 10.21.0.2 wallet init</span><br><span class="line">SHOW ENGINE INNODB STATUS</span><br><span class="line">---TRANSACTION 167433, not started</span><br><span class="line">MySQL thread id 2700100, OS thread handle 0x7fd5dd7fa700, query id 16185344 10.100.27.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 167449, not started</span><br><span class="line">MySQL thread id 2700073, OS thread handle 0x7fd5e6581700, query id 16186116 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 167434, not started</span><br><span class="line">MySQL thread id 2700060, OS thread handle 0x7fd5e6685700, query id 16185479 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699993, OS thread handle 0x7fd5dd5f2700, query id 16184159 10.100.27.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699968, OS thread handle 0x7fd5dd633700, query id 16183926 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699967, OS thread handle 0x7fd5dd7b9700, query id 16183863 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699966, OS thread handle 0x7fd5e6540700, query id 16183754 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699965, OS thread handle 0x7fd5e4049700, query id 16183668 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699964, OS thread handle 0x7fd5e66c6700, query id 16183581 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 0, not started</span><br><span class="line">MySQL thread id 2699963, OS thread handle 0x7fd5dd6b5700, query id 16183494 10.100.53.2 wallet cleaning up</span><br><span class="line">---TRANSACTION 167457, ACTIVE 11 sec inserting</span><br><span class="line">mysql tables in use 1, locked 1</span><br><span class="line">LOCK WAIT 2 lock struct(s), heap size 360, 1 row lock(s), undo log entries 1</span><br><span class="line">MySQL thread id 2700275, OS thread handle 0x7fd5dd737700, query id 16186778 10.21.0.2 wallet update</span><br><span class="line">INSERT INTO `ttt` (`id`, `no`, `trade_number`)</span><br><span class="line">VALUES</span><br><span class="line">	(586, &#x27;856195904590458889&#x27;, &#x27;200526175912156728&#x27;)</span><br><span class="line">------- TRX HAS BEEN WAITING 11 SEC FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id 50 page no 5 n bits 96 index `idx_number` of table `test`.`ttt` trx id 167457 lock_mode X locks gap before rec insert intention waiting</span><br><span class="line">Record lock, heap no 14 PHYSICAL RECORD: n_fields 2; compact format; info bits 0</span><br><span class="line"> 0: len 29; hex 5a484c4956454255593230313730353236323233323432363434353939; asc ZHLIVEBUY20170526223242644599;;</span><br><span class="line"> 1: len 8; hex 0000000000000229; asc        );;</span><br><span class="line"></span><br><span class="line">------------------</span><br><span class="line">---TRANSACTION 167447, ACTIVE 602 sec</span><br><span class="line">4 lock struct(s), heap size 1184, 3 row lock(s)</span><br><span class="line">MySQL thread id 2699383, OS thread handle 0x7fd5e4251700, query id 16186751 10.21.0.2 wallet cleaning up</span><br><span class="line">--------</span><br><span class="line">FILE I/O</span><br><span class="line">--------</span><br><span class="line">I/O thread 0 state: waiting for completed aio requests (insert buffer thread)</span><br><span class="line">I/O thread 1 state: waiting for completed aio requests (log thread)</span><br><span class="line">I/O thread 2 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 3 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 4 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 5 state: waiting for completed aio requests (read thread)</span><br><span class="line">I/O thread 6 state: waiting for completed aio requests (write thread)</span><br><span class="line">I/O thread 7 state: waiting for completed aio requests (write thread)</span><br><span class="line">I/O thread 8 state: waiting for completed aio requests (write thread)</span><br><span class="line">I/O thread 9 state: waiting for completed aio requests (write thread)</span><br><span class="line">Pending normal aio reads: 0 [0, 0, 0, 0] , aio writes: 0 [0, 0, 0, 0] ,</span><br><span class="line"> ibuf aio reads: 0, log i/o&#x27;s: 0, sync i/o&#x27;s: 0</span><br><span class="line">Pending flushes (fsync) log: 0; buffer pool: 0</span><br><span class="line">6707 OS file reads, 383968 OS file writes, 119945 OS fsyncs</span><br><span class="line">0.00 reads/s, 0 avg bytes/read, 0.11 writes/s, 0.09 fsyncs/s</span><br><span class="line">-------------------------------------</span><br><span class="line">INSERT BUFFER AND ADAPTIVE HASH INDEX</span><br><span class="line">-------------------------------------</span><br><span class="line">Ibuf: size 1, free list len 74, seg size 76, 733 merges</span><br><span class="line">merged operations:</span><br><span class="line"> insert 34, delete mark 169019, delete 2</span><br><span class="line">discarded operations:</span><br><span class="line"> insert 0, delete mark 0, delete 0</span><br><span class="line">Hash table size 149489, node heap has 168 buffer(s)</span><br><span class="line">0.00 hash searches/s, 0.05 non-hash searches/s</span><br><span class="line">---</span><br><span class="line">LOG</span><br><span class="line">---</span><br><span class="line">Log sequence number 394355624</span><br><span class="line">Log flushed up to   394355624</span><br><span class="line">Pages flushed up to 394355624</span><br><span class="line">Last checkpoint at  394355624</span><br><span class="line">0 pending log writes, 0 pending chkp writes</span><br><span class="line">65750 log i/o&#x27;s done, 0.04 log i/o&#x27;s/second</span><br><span class="line">----------------------</span><br><span class="line">BUFFER POOL AND MEMORY</span><br><span class="line">----------------------</span><br><span class="line">Total memory allocated 77266944; in additional pool allocated 0</span><br><span class="line">Dictionary memory allocated 669112</span><br><span class="line">Buffer pool size   4607</span><br><span class="line">Free buffers       1024</span><br><span class="line">Database pages     3415</span><br><span class="line">Old database pages 1240</span><br><span class="line">Modified db pages  0</span><br><span class="line">Pending reads 0</span><br><span class="line">Pending writes: LRU 0, flush list 0, single page 0</span><br><span class="line">Pages made young 11699, not young 475003</span><br><span class="line">0.00 youngs/s, 0.00 non-youngs/s</span><br><span class="line">Pages read 6606, created 13587, written 300725</span><br><span class="line">0.00 reads/s, 0.00 creates/s, 0.05 writes/s</span><br><span class="line">Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000</span><br><span class="line">Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s</span><br><span class="line">LRU len: 3415, unzip_LRU len: 0</span><br><span class="line">I/O sum[3]:cur[0], unzip sum[0]:cur[0]</span><br><span class="line">--------------</span><br><span class="line">ROW OPERATIONS</span><br><span class="line">--------------</span><br><span class="line">0 queries inside InnoDB, 0 queries in queue</span><br><span class="line">0 read views open inside InnoDB</span><br><span class="line">Main thread process no. 12657, id 140556665968384, state: sleeping</span><br><span class="line">Number of rows inserted 227014, updated 19739, deleted 89828, read 47831814</span><br><span class="line">0.00 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s</span><br><span class="line">----------------------------</span><br><span class="line">END OF INNODB MONITOR OUTPUT</span><br><span class="line">============================</span><br><span class="line"></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div></div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/resource/file/wechat_mini.jpg" alt="noogel 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/resource/file/alipay_mini.jpg" alt="noogel 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/resource/file/qrcode_for_gh_4223a67f3865_258.jpg">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2017/10/08/1.html" rel="prev" title="这些 Mac 神器也许你正需要">
                  <i class="fa fa-chevron-left"></i> 这些 Mac 神器也许你正需要
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2017/12/27/1.html" rel="next" title="2018知识储备计划">
                  2018知识储备计划 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">noogel</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js","integrity":"sha256-96rwDGMWIQYB0yKGp1sKi1yrjrLPj2oT39IpbCsIrsg="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"noogel","repo":"noogel.github.io","client_id":"41a4e14aca0b3552334a","client_secret":"ebe0f9bfd24824f3d0d0f41bfd88a8736353759b","admin_user":"noogel","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"902a54be4f690703b34538efb9ede001"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
